---
import { Image } from 'astro:assets';
import '../../styles/home/carruselPatrocinios.css';
import '../../styles/home/apoyanosbtn.css';

/* 1. TUS DATOS */
const patrocinadores = [
  { img: 'altair.webp', nombre: 'Altair', url: 'https://altair.com' },
  { img: 'ansys.webp', nombre: 'Ansys', url: 'https://www.ansys.com' },
  { img: 'bimsa.webp', nombre: 'BIMSA', url: 'https://www.linkedin.com/company/bombas-internacionales-mexicanas-sa-cv/?originalSubdomain=mx' }, 
  { img: 'copiisa.webp', nombre: 'Copiisa', url: 'https://copiisa.com.mx' },
  { img: 'mantemimiento.webp', nombre: 'Mantenimiento Industrial', url: 'https://mantto.mx/' },
  { img: 'polimex.webp', nombre: 'Polimex', url: 'https://www.polimex.mx' },
  { img: 'SMI.webp', nombre: 'SMI México', url: 'https://www.smimexico.com.mx/' },
  { img: 'solidwor.webp', nombre: 'SolidWorks', url: 'https://www.solidworks.com' },
  { img: 'tmx.webp', nombre: 'TMX Toolmex', url: 'https://hvhindustrial.com/es/brand/toolmex-tmx' },
  { img: 'toyota.webp', nombre: 'Toyota', url: 'https://www.toyota.mx' },
  { img: 'IPN.webp', nombre: 'Instituto Politécnico Nacional', url: 'https://www.ipn.mx' }
];

/* 2. CARGA DE IMÁGENES (Astro Assets) 
   Asegúrate de que la ruta '../../assets/IMGpatrocinadores/' sea correcta 
   desde donde está guardado ESTE archivo.
*/
const images = import.meta.glob('../../assets/IMGpatrocinadores/*.{png,webp,jpg,svg,jpeg,PNG}', { eager: true });

/* 3. FUNCIÓN MATCH */
const getLogoImage = (filename: string) => {
    const imagePath = Object.keys(images).find(path => path.endsWith(filename));
    if (!imagePath) {
        console.error(`⚠️ Logo no encontrado: ${filename}`);
        return null; 
    }
    return (images[imagePath] as any).default;
};
---

<section class="sponsors-section scroll-animate">
    
    <h2 class="titulo-seccion">PATROCINADORES</h2>

    <p class="sponsors-desc">
        Agradecemos profundamente a nuestros socios estratégicos. Su apoyo en tecnología, 
        manufactura y recursos hace posible que la ingeniería mexicana compita al más alto nivel.
    </p>

    <div class="sponsors-marquee">
        {/* BLOQUE 1: Original */}
        {patrocinadores.map((pat) => {
            const logoImg = getLogoImage(pat.img);
            return (
                <a 
                    href={pat.url} 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    class="sponsor-card" 
                    aria-label={`Visitar sitio de ${pat.nombre}`}
                >
                    {logoImg ? (
                        <Image 
                            src={logoImg} 
                            alt={`Logo de ${pat.nombre}`} 
                            width={300} 
                            height={150} 
                            loading="lazy" 
                            decoding="async" 
                        />
                    ) : (
                        <span>{pat.nombre}</span> /* Fallback por si falta la imagen */
                    )}
                </a>
            );
        })}

        {/* BLOQUE 2: Duplicado para efecto infinito */}
        {patrocinadores.map((pat) => {
            const logoImg = getLogoImage(pat.img);
            return (
                <a 
                    href={pat.url} 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    class="sponsor-card" 
                    aria-label={`Visitar sitio de ${pat.nombre}`} 
                    tabindex="-1"
                >
                    {logoImg && (
                        <Image 
                            src={logoImg} 
                            alt="" 
                            width={300} 
                            height={150} 
                            loading="lazy" 
                            decoding="async" 
                        />
                    )}
                </a>
            );
        })}
    </div>

    <div class="center-content">
        <a href="/sponsors" class="boton-legendario">SER PATROCINADOR</a>
    </div>
</section>