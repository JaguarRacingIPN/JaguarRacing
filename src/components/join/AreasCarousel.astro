---
import { Image } from 'astro:assets';
import '../../styles/join/section-areas.css';

const areaImages = await Astro.glob('../../assets/Areas/*.{jpg,JPG,jpeg,JPEG,png,PNG,webp,WEBP}');

areaImages.sort((a, b) => {
    const nameA = a.default.src.split('/').pop();
    const nameB = b.default.src.split('/').pop();
    return nameA.localeCompare(nameB, undefined, { numeric: true, sensitivity: 'base' });
});
---

<section class="areas-showcase scroll-animate">
    <h2 class="areas-showcase__title">Nuestras Áreas</h2>
    
    <div class="carousel-wrapper">
        <button class="areas-showcase__btn areas-showcase__btn--prev" id="btn-prev" aria-label="Ver área anterior">&#10094;</button>

        <div class="areas-carousel" id="carruselAreas">
            {areaImages.map((img, index) => (
                <div class="area-card">
                    <Image 
                        src={img.default} 
                        alt={`Área ${index + 1} - Jaguar Racing`}
                        class="area-card__img"
                        widths={[320, 480, 640, 800, 1024, 1280]}
                        sizes="(max-width: 640px) 90vw, (max-width: 1024px) 45vw, 640px"
                        quality={82}
                        format="webp"
                        
                        loading="lazy" 
                        decoding="async"
                    />
                </div>
            ))}
        </div>

        <button class="areas-showcase__btn areas-showcase__btn--next" id="btn-next" aria-label="Ver siguiente área">&#10095;</button>
    </div>
    
    <div class="areas-showcase__indicators" id="indicadores"></div>
</section>

<script>
    import { initAreasCarousel } from '../../scripts/areasCarousel.js';
    
    let cleanupFn: Function | undefined;
    
    document.addEventListener('astro:page-load', () => {
        if (cleanupFn) cleanupFn();
        cleanupFn = initAreasCarousel();
    });
    
    document.addEventListener('astro:before-swap', () => {
        if (cleanupFn) {
            cleanupFn();
            cleanupFn = undefined;
        }
    });
</script>