---
import { Image } from 'astro:assets';
import roster from '../../data/miembros.json';
import '../../styles/team/team-card.css';

import linkedInIcon from '../../assets/logos/linkedIn_.webp';
const teamPhotos = import.meta.glob('../../assets/team/*.{jpg,jpeg,png,webp}', { eager: true });

function getTeamPhoto(filename: string) {
    const path = `../../assets/team/${filename}`;
    const photo = teamPhotos[path] as any;
    
    if (!photo) {
        console.warn(`Foto no encontrada: ${filename}`);
        return null;
    }
    
    return photo.default || photo;
}
---

<div class="roster-section">
    {roster.map((seccion) => (
        <section class="roster-category scroll-animate">
            <div class="category-header">
                <span class="gold-line"></span>
                <h2 class="category-title">{seccion.categoria}</h2>
                <span class="gold-line"></span>
            </div>

            <div class="roster-grid">
                {seccion.integrantes.map((miembro) => {
                    const foto = getTeamPhoto(miembro.foto);
                    
                    return (
                        <div class="roster-card">
                            <div class="roster-img-box">
                                {foto ? (
                                    <Image 
                                        src={foto}
                                        alt={`${miembro.nombre} - ${miembro.rol}`}
                                        class="roster-img" 
                                        widths={[150, 300, 400]}
                                        sizes="(max-width: 640px) 150px, 300px"
                                        quality={85}
                                        format="webp"
                                        loading="lazy" 
                                        decoding="async"
                                    />
                                ) : (
                                    <div class="roster-img-placeholder">
                                        <span>Foto no disponible</span>
                                    </div>
                                )}
                            </div>

                            <div class="roster-info">
                                <div class="roster-role">{miembro.rol}</div>
                                <h3 class="roster-name">{miembro.nombre}</h3>
                                <p class="roster-career">{miembro.carrera}</p>
                                
                                {miembro.linkedin && (
                                    <a 
                                        href={miembro.linkedin} 
                                        target="_blank" 
                                        rel="noopener noreferrer" 
                                        class="roster-social-link" 
                                        aria-label={`LinkedIn de ${miembro.nombre}`}
                                    >
                                        <Image 
                                            src={linkedInIcon}
                                            alt="LinkedIn"
                                            class="linkedin-icon"
                                            widths={[48, 96]} 
                                            sizes="48px"
                                            quality={100}
                                            format="webp"
                                            loading="lazy"
                                            decoding="async"
                                        />
                                    </a>
                                )}
                            </div>
                        </div>
                    );
                })}
            </div>
        </section>
    ))}
</div>