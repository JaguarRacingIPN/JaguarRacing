---
// src/components/layout/Header.astro
import { Image } from "astro:assets";

import jaguarLogo from "../../assets/logos/JaguarLogo.webp";

// 1. Lógica Server-Side
const pathname = new URL(Astro.url).pathname.replace(/\/$/, "") || "/";

const isActive = (path: string) =>
    pathname === path ? "nav-link--active" : "";
const isMobileActive = (path: string) =>
    pathname === path ? "mobile-nav__link--active" : "";
---

<header class="main-navbar" id="main-navbar">
    <div class="nav-left">
        <a href="/" aria-label="Volver al inicio">
            <Image
                src={jaguarLogo}
                class="main-navbar__logo"
                alt="Jaguar Racing Logo"
                widths={[120, 150, 200, 300]}
                sizes="(max-width: 480px) 120px, (max-width: 768px) 150px, 200px"
                
                quality={90}
                format="webp"
                loading="eager"
                fetchpriority="high"
                decoding="async"
            />
        </a>
    </div>

    <div class="main-navbar__links">
        <a href="/" class={`nav-link ${isActive("/")}`} data-astro-prefetch="viewport">INICIO</a>
        <a href="/join" class={`nav-link ${isActive("/join")}`} data-astro-prefetch="viewport">CONVOCATORIA</a>
        <a href="/team" class={`nav-link ${isActive("/team")}`} data-astro-prefetch="viewport">CONOCE AL EQUIPO</a>
        <a href="/history" class={`nav-link ${isActive("/history")}`} data-astro-prefetch="viewport">NUESTRA TRAYECTORIA</a>
        <a href="/sponsors" class={`nav-link ${isActive("/sponsors")}`} data-astro-prefetch="viewport">PATROCINIOS</a>
    </div>

    <div class="main-navbar__actions">
        <button class="nav-toggle" id="nav-toggle" aria-label="Abrir menú">
            <span class="nav-toggle__bar"></span>
            <span class="nav-toggle__bar"></span>
            <span class="nav-toggle__bar"></span>
        </button>
    </div>
</header>

<div class="mobile-overlay" id="mobile-overlay"></div>

<nav class="mobile-nav" id="mobile-nav">
    <button class="mobile-nav__close" id="close-nav" aria-label="Cerrar menú">&times;</button>

    <div class="sidebar-content">
        <h4 class="mobile-nav__title">Menú</h4>

        <a href="/" class={`mobile-nav__link ${isMobileActive("/")}`} data-astro-prefetch="viewport">Inicio</a>
        <a href="/join" class={`mobile-nav__link ${isMobileActive("/join")}`} data-astro-prefetch="viewport">Convocatoria</a>
        <a href="/team" class={`mobile-nav__link ${isMobileActive("/team")}`} data-astro-prefetch="viewport">Conoce al equipo</a>
        <a href="/history" class={`mobile-nav__link ${isMobileActive("/history")}`} data-astro-prefetch="viewport">Nuestra Trayectoria</a>
        <a href="/sponsors" class={`mobile-nav__link ${isMobileActive("/sponsors")}`} data-astro-prefetch="viewport">Patrocinios</a>
    </div>
</nav>

<style>
    .nav-link--active {
        border-bottom: 2px solid var(--jaguar-gold) !important;
        color: var(--jaguar-gold) !important;
    }

    .mobile-nav__link--active {
        color: var(--jaguar-gold) !important;
        border-left: 3px solid var(--jaguar-gold);
        padding-left: 10px;
    }
</style>

<script>
    import {
        updateActiveLinks,
        initHeaderListeners,
    } from "../../scripts/header.js";

    document.addEventListener("astro:page-load", () => {
        updateActiveLinks();
        initHeaderListeners();
    });
</script>