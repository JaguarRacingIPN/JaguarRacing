---
import { Image } from "astro:assets";

const patrocinadores = [
    {
        img: "SMI.webp",
        nombre: "SMI México",
        url: "https://www.smimexico.com.mx/",
    },
    {
        img: "solidwor.webp",
        nombre: "SolidWorks",
        url: "https://www.solidworks.com",
    },
    {
        img: "copiisa.webp",
        nombre: "Copiisa",
        url: "https://www.linkedin.com/company/copiisaoffshore/?originalSubdomain=mx",
    },
    {
        img: "bimsa.webp",
        nombre: "BIMSA",
        url: "https://www.linkedin.com/company/bombas-internacionales-mexicanas-sa-cv",
    },
    { img: "altair.webp", nombre: "Altair", url: "https://altair.com" },
    { img: "toyota.webp", nombre: "Toyota", url: "https://www.toyota.mx" },
    {
        img: "xpertme.webp",
        nombre: "XpertMe",
        url: "https://store.xpertme.com/",
    },
    {
        img: "dassault.webp",
        nombre: "Dassault Systèmes",
        url: "https://www.3ds.com/es/",
    },
    { img: "Hexagono.webp", nombre: "Hexagon", url: "https://hexagon.com" },
    {
        img: "IPN.webp",
        nombre: "Instituto Politécnico Nacional",
        url: "https://www.ipn.mx",
    },
];

/* 2. CARGA INTELIGENTE DE IMÁGENES */
const images = import.meta.glob(
    "../../assets/IMGpatrocinadores/*.{png,webp,jpg,svg,jpeg,PNG}",
    { eager: true },
);

/* 3. FUNCIÓN DE CRUCE */
const getLogoImage = (filename: string) => {
    const imagePath = Object.keys(images).find((path) =>
        path.endsWith(filename),
    );

    if (!imagePath) {
        console.error(`Imagen no encontrada en assets: ${filename}`);
        return null;
    }

    return (images[imagePath] as any).default;
};
---

<section class="sponsors-grid-section scroll-animate">
    <div class="sponsors-grid">
        {
            patrocinadores.map((sponsor) => {
                const logoImg = getLogoImage(sponsor.img);

                return (
                    <a
                        href={sponsor.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="sponsor-card"
                        title={`Visitar sitio web de ${sponsor.nombre}`}
                        aria-label={`Logo de ${sponsor.nombre} - Patrocinador oficial`}
                    >
                        {logoImg ? (
                            <Image
                                src={logoImg}
                                alt={`${sponsor.nombre} - Patrocinador oficial de Jaguar Racing`}
                                class="sponsor-logo"
                                widths={[150, 200, 300, 400]}
                                sizes="(max-width: 480px) 150px, (max-width: 768px) 200px, 300px"
                                quality={90}
                                format="webp"
                                loading="lazy"
                                decoding="async"
                            />
                        ) : (
                            <div class="sponsor-logo-fallback">
                                <span>{sponsor.nombre}</span>
                            </div>
                        )}
                    </a>
                );
            })
        }
    </div>
</section>
