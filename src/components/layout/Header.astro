---
// src/components/layout/Header.astro

// 1. Lógica Server-Side
const pathname = new URL(Astro.url).pathname.replace(/\/$/, '') || '/';

const isActive = (path: string) => pathname === path ? 'nav-link--active' : '';
const isMobileActive = (path: string) => pathname === path ? 'mobile-nav__link--active' : '';
---

<header class="main-navbar" id="main-navbar">
    <div class="nav-left">
        <a href="/" aria-label="Volver al inicio">
            <img 
                src='/img/page/JaguarLogo.webp' 
                class='main-navbar__logo' 
                alt='Jaguar Racing Logo'
                width="165" 
                height="55"
                decoding="async"
                loading="eager" 
            >
        </a>
    </div>

    <div class="main-navbar__links">
        <a href="/" class={`nav-link ${isActive('/')}`}>INICIO</a>
        <a href="/join" class={`nav-link ${isActive('/join')}`}>CONVOCATORIA</a>
        <a href="/team" class={`nav-link ${isActive('/team')}`}>CONOCE AL EQUIPO</a>
        <a href="/history" class={`nav-link ${isActive('/history')}`}>NUESTRA TRAYECTORIA</a>
        <a href="/sponsors" class={`nav-link ${isActive('/sponsors')}`}>PATROCINIOS</a>
    </div>

    <div class="main-navbar__actions">
        <button class="nav-toggle" id="nav-toggle" aria-label="Abrir menú">
            <span class="nav-toggle__bar"></span>
            <span class="nav-toggle__bar"></span>
            <span class="nav-toggle__bar"></span>
        </button>
    </div>
</header>

<div class="mobile-overlay" id="mobile-overlay"></div>

<nav class="mobile-nav" id="mobile-nav">
    <button class="mobile-nav__close" id="close-nav" aria-label="Cerrar menú">&times;</button>
    
    <div class="sidebar-content">
        <h4 class="mobile-nav__title">Menú</h4>
        
        <a href="/" class={`mobile-nav__link ${isMobileActive('/')}`}>Inicio</a>
        <a href="/join" class={`mobile-nav__link ${isMobileActive('/join')}`}>Convocatoria</a>
        <a href="/team" class={`mobile-nav__link ${isMobileActive('/team')}`}>Conoce al equipo</a>
        <a href="/history" class={`mobile-nav__link ${isMobileActive('/history')}`}>Nuestra Trayectoria</a>
        <a href="/sponsors" class={`mobile-nav__link ${isMobileActive('/sponsors')}`}>Patrocinios</a>
    </div>

    <img 
        src="/img/page/JaguarLogo.webp" 
        class="sidebar-logo-bottom" 
        alt="Logo Jaguar" 
        width="100" 
        height="33"
        loading="lazy"
        decoding="async"
        style="width: 100px; margin: 20px auto; display: block; opacity: 0.5;"
    >
</nav>

<style>
    /* Estilos de estado activo */
    .nav-link--active {
        border-bottom: 2px solid var(--jaguar-gold) !important;
        color: var(--jaguar-gold) !important;
    }
    
    .mobile-nav__link--active {
        color: var(--jaguar-gold) !important;
        border-left: 3px solid var(--jaguar-gold);
        padding-left: 10px;
    }
</style>

<script>
    // CAMBIO: Ajuste de ruta (subimos dos niveles: components -> layout -> scripts)
    import { updateActiveLinks, initHeaderListeners } from '../../scripts/header.js';

    // Se ejecuta en cada navegación (View Transitions)
    document.addEventListener('astro:page-load', () => {
        // 1. Actualizar qué link está encendido (siempre se ejecuta)
        updateActiveLinks();
        
        // 2. Inicializar listeners (Solo se ejecuta la primera vez gracias al chequeo interno)
        initHeaderListeners();
    });
</script>