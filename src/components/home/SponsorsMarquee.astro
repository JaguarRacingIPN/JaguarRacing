---
/**
 * =============================================================================
 * COMPONENTE: CARRUSEL DE PATROCINADORES (INFINITE SCROLL)
 * =============================================================================
 * Lógica: Renderiza una lista duplicada de logos para crear un efecto de
 * desplazamiento infinito vía CSS.
 */

import { Image } from "astro:assets";
import "../../styles/home/section-sponsors.css";

/* -----------------------------------------------------------------------------
   1. TYPES & DATA
   ----------------------------------------------------------------------------- */
interface Sponsor {
    img: string;
    nombre: string;
    url: string;
}

const patrocinadores: Sponsor[] = [
    {
        img: "SMI.webp",
        nombre: "SMI México",
        url: "https://www.smimexico.com.mx/",
    },
    {
        img: "solidwor.webp",
        nombre: "SolidWorks",
        url: "https://www.solidworks.com",
    },
    {
        img: "copiisa.webp",
        nombre: "Copiisa",
        url: "https://www.linkedin.com/company/copiisaoffshore/?originalSubdomain=mx",
    },
    {
        img: "bimsa.webp",
        nombre: "BIMSA",
        url: "https://www.linkedin.com/company/bombas-internacionales-mexicanas-sa-cv",
    },
    { img: "altair.webp", nombre: "Altair", url: "https://altair.com" },
    { img: "toyota.webp", nombre: "Toyota", url: "https://www.toyota.mx" },
    {
        img: "xpertme.webp",
        nombre: "XpertMe",
        url: "https://store.xpertme.com/",
    },
    {
        img: "dassault.webp",
        nombre: "Dassault Systèmes",
        url: "https://www.3ds.com/es/",
    },
    { img: "Hexagono.webp", nombre: "Hexagon", url: "https://hexagon.com" },
    {
        img: "IPN.webp",
        nombre: "Instituto Politécnico Nacional",
        url: "https://www.ipn.mx",
    },
];

/* -----------------------------------------------------------------------------
   2. ASSET LOADING (DYNAMIC)
   -----------------------------------------------------------------------------*/
const images = import.meta.glob<{ default: ImageMetadata }>(
    "../../assets/IMGpatrocinadores/*.{png,webp,jpg,svg,jpeg,PNG}",
    { eager: true },
);

const getLogoImage = (filename: string) => {
    const imagePath = Object.keys(images).find((path) =>
        path.endsWith(filename),
    );
    if (!imagePath) {
        console.warn(`[Sponsors] Logo no encontrado: ${filename}`);
        return null;
    }
    return images[imagePath].default;
};

/* -----------------------------------------------------------------------------
   3. INFINITE LOOP PREPARATION
   ----------------------------------------------------------------------------- */
// Duplicamos la lista para permitir que la animación CSS fluya sin cortes.
const listaInfinita = [...patrocinadores, ...patrocinadores];
---

<section class="sponsors-section scroll-animate">
    <h2 class="titulo-seccion">PATROCINADORES</h2>

    <p class="sponsors-desc">
        Agradecemos profundamente a nuestros socios estratégicos. Su apoyo en
        tecnología, manufactura y recursos hace posible que la ingeniería
        mexicana compita al más alto nivel.
    </p>

    {/* --- PISTA ANIMADA --- */}
    <div class="sponsors-marquee">
        {
            listaInfinita.map((pat, index) => {
                const logoImg = getLogoImage(pat.img);

                const isDuplicate = index >= patrocinadores.length;

                return (
                    <a
                        href={pat.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="sponsor-card"
                        aria-label={
                            isDuplicate
                                ? null
                                : `Visitar sitio de ${pat.nombre}`
                        }
                        aria-hidden={isDuplicate ? "true" : undefined}
                        tabindex={isDuplicate ? "-1" : "0"}
                    >
                        {logoImg ? (
                            <Image
                                src={logoImg}
                                alt={isDuplicate ? "" : `Logo de ${pat.nombre}`}
                                widths={[180, 240, 360]}
                                sizes="(max-width: 480px) 180px, 240px"
                                format="webp"
                                quality={80}
                                class="sponsor-img-fit"
                                loading="lazy"
                                decoding="async"
                            />
                        ) : (
                            /* Fallback textual si falla la imagen */
                            <span class="text-fallback">{pat.nombre}</span>
                        )}
                    </a>
                );
            })
        }
    </div>

    <div class="center-content">
        <a href="/sponsors" class="boton-legendario">SER PATROCINADOR</a>
    </div>
</section>

<style>
    .sponsor-img-fit {
        width: 100%;
        height: auto;
        /* Permitimos que el CSS externo controle el max-width/height para el padding */
        object-fit: contain;
        display: block;
    }

    .text-fallback {
        color: var(--text-white, #fff);
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.9rem;
    }
</style>
