---
// --- ZONA DE LÓGICA (Server Side) ---
import Layout from '../layouts/Layout.astro';
import Footer from '../components/Footer.astro';

// 1. Herramienta de imágenes de Astro
import { Image } from 'astro:assets';

// Importamos los CSS específicos
import '../styles/indexCuerpo.css';
import '../styles/carruselPatrocinios.css';
import '../styles/apoyanosbtn.css';
import '../styles/marcoConocenos.css';
import '../styles/contadores.css';
import '../styles/miniJuego.css';
import '../styles/NoSelect.css';

const pageTitle = "Inicio";

// 2. CARGAR IMÁGENES
// Asegúrate de que las fotos estén en src/assets/Portada/
const backgroundImages = await Astro.glob('../assets/Portada/*.{jpg,JPG,jpeg,JPEG,png,PNG,webp,WEBP}');

// 3. Array de Patrocinadores
const patrocinadores = [
  'altair.webp', 'ansys.webp', 'bimsa.webp', 'copiisa.webp', 
  'mantemimiento.webp', 'polimex.webp', 'SMI.webp', 
  'solidwor.webp', 'tmx.webp', 'toyota.webp', 'IPN.webp'
];
---

<Layout title={pageTitle}>

    <main>
        
        <hero-slider class="hero-background-container">
            
            <div class="slideshow-wrapper">
                {backgroundImages.map((img, index) => (
                    <div class={`bg-slide ${index === 0 ? 'active' : ''}`}>
                       <Image 
                            src={img.default} 
                            alt="Jaguar Racing Portada"
                            width={1920}
                            height={1080}
                            format="webp"
                            quality="mid"
                            widths={[640, 1024, 1920]}
                            sizes="100vw"
                            loading={index === 0 ? "eager" : "lazy"}
                            class="bg-image-fit"
                        />
                        <div class="overlay-dark"></div>
                    </div>
                ))}
            </div>

            <div class="hero-content-fixed">
                <h1 class="hero__title">Jaguar Racing</h1>
            </div>
            
        </hero-slider>

        <div class="about-section">
            <div class="about-section__content">
                <h2>¿Quiénes somos?</h2>
                <p>Somos una escudería universitaria del INSTITUTO POLITÉCNICO NACIONAL apasionada por la ingeniería y
                    las competencias, buscando consolidar y posicionar al equipo como una escudería líder en el mundo
                    BAJA, representando y poniendo en alto nuestra escuela y el instituto por medio de una eficiente
                    estructura de trabajo.</p>
            </div>

            <div class="about-section__side-content">
                
                <div class="marco-halo-container">
                    <div class="bracket top-left"></div>
                    <div class="bracket bottom-right"></div>
                    
                    <div class="halo-inner-shadow">
                        <img 
                            src="/img/Conocenos/7.webp" 
                            alt="Equipo Jaguar Racing" 
                            class="foto-equipo-cad" 
                            loading="lazy" 
                            width="500" 
                            height="300"
                        >
                    </div>
                </div>

                <div class="social-buttons-container">
                    <a href="/team" class="btn-mini-primary">CONOCER EQUIPO</a>
                    
                    <div class="social-separator"></div>

                    <div class="social-icons-row">
                        <a href="https://www.facebook.com/people/Jaguar-Racing-IPN/" target="_blank" rel="noopener noreferrer" class="social-icons__link">
                            <img src="/img/page/ImgFaceeBook.webp" alt="Facebook" width="30" height="30" class="social-icons__img">
                        </a>
                        <a href="https://www.instagram.com/jaguar_racing_team/" target="_blank" rel="noopener noreferrer" class="social-icons__link">
                            <img src="/img/page/ImgIG.webp" alt="Instagram" width="30" height="30" class="social-icons__img">
                        </a>
                        <a href="https://www.linkedin.com" target="_blank" rel="noopener noreferrer" class="social-icons__link">
                            <img src="/img/page/linkedIn_.webp" alt="LinkedIn" width="30" height="30" class="social-icons__img">
                        </a>
                    </div>
                </div>

            </div>
        </div>

        <div class="about-section">
            <img src="/img/page/ImgBajaSae.webp" class="about-section__logo" alt="Baja SAE" loading="lazy" decoding="async" width="200" height="200">
            <div class="about-section__content">
                <h2>¿Qué es BAJA SAE?</h2>
                <p>Baja SAE desafía a los estudiantes de ingeniería a diseñar y construir un vehículo todoterreno que
                    sobreviva al severo castigo del terreno accidentado y, en algunas competencias, al agua. El objetivo
                    de cada equipo es diseñar y construir un prototipo de un vehículo recreativo todoterreno, robusto,
                    de un solo asiento y apto para todo tipo de clima.</p>
            </div>
        </div>

        <div class="about-section">
            <div class="about-section__content">
                <p>SAE International es una asociación mundial comprometida con ser la principal fuente de conocimiento
                    para la profesión de ingeniería. Al unir a más de 145,000 ingenieros y expertos técnicos, impulsamos
                    el conocimiento y la experiencia en un amplio espectro de industrias.</p>
            </div>
            <img src="/img/page/ImgSAE.webp" class="about-section__logo" alt="SAE Internacional" loading="lazy" decoding="async" width="200" height="200">
        </div>

        <div class="join-cta">
            <video 
                class="cta-video-bg" 
                autoplay 
                loop 
                muted 
                playsinline 
                preload="auto"
                poster="/img/page/Registro.webp" 
            >
                <source src="/videos/VideoConv.mp4" type="video/mp4">
            </video>

            <div class="cta-overlay"></div>

            <div class="join-cta__text">
                <h2>ÚNETE A<br>NUESTRO<br>EQUIPO</h2>
                <p>Abierto a todas las carreras y semestres que curses. Jaguar Racing te prepara para un mejor
                    rendimiento fuera y dentro de las aulas.</p>
                <a href="/join" class="boton-registro">REGISTRARME</a>
            </div>
        </div>

        <div class="sponsors-section">
            <h2 class="titulo-seccion">Patrocinadores</h2>
            <p class="sponsors-section__desc">
                Múltiples empresas han donado generosamente tiempo, dinero o materiales al equipo, por lo cual
                    estamos, y siempre estaremos, muy agradecidos.
                    Somos un equipo 100% universitario y sin fines de lucro, por lo que dependemos completamente de la
                    financiación de patrocinadores. Si a usted o a su empresa le interesa el proyecto, le invitamos a
                    considerar apoyarnos.
            </p>

            <div class="sponsors-marquee">
                {patrocinadores.map((img) => (
                    <div class="sponsor-card">
                        <img src={`/img/IMGpatrocinadores/${img}`} alt="Patrocinador" width="200" height="100" loading="lazy" decoding="async" />
                    </div>
                ))}
                {patrocinadores.map((img) => (
                    <div class="sponsor-card">
                        <img src={`/img/IMGpatrocinadores/${img}`} alt="Patrocinador" width="200" height="100" loading="lazy" decoding="async" />
                    </div>
                ))}
            </div>

            <div class="center-content">
                <a href="/sponsors" class="boton-legendario">APÓYANOS</a>
            </div>
        </div>

        <section class="events-section">
            <h2 class="titulo-participaciones">CRONOGRAMA OPERATIVO</h2>
            <div class="events-grid">
                <div class="event-card">
                    <img src="/img/page/ImgIPN.webp" alt="IPN" class="event-card__img" width="100" height="100" loading="lazy">
                    <div class="event-card__info">
                        <h3>REINGRESO A TALLERES</h3>
                        <div id="timer-usa" class="countdown-timer">00d 00h 00m</div>
                    </div>
                </div>
                <div class="event-card">
                    <div class="event-card__info">
                        <h3>ARRANQUE DE TEMPORADA</h3>
                        <div id="timer-mexico" class="countdown-timer">00d 00h 00m</div>
                    </div>
                    <img src="/img/page/JaguarLogo.webp" alt="Baja SAE" class="event-card__img" width="100" height="100" loading="lazy">
                </div>
            </div>
        </section>

        <section class="reaction-game-section">
            <div class="reaction-game-container">
                <h2 class="reaction-title">TEST DE REFLEJOS <span class="gold-text">JAGUAR</span></h2>
                <p class="reaction-instruction">Espera a que las luces cambien a VERDE y presiona el botón.</p>
                <div class="semaphore-board">
                    <div class="light" id="light-1"></div>
                    <div class="light" id="light-2"></div>
                    <div class="light" id="light-3"></div>
                    <div class="light" id="light-4"></div>
                    <div class="light" id="light-5"></div>
                </div>
                <div id="reaction-result" class="reaction-result">0.000 ms</div>
                <div class="stats-container">
                    <div id="player-rank" class="rank-badge">---</div>
                    <div class="best-time-box">RÉCORD: <span id="best-time-display">--</span></div>
                </div>
                <button id="reaction-btn" class="btn-race">
                    <span class="btn-text">INICIAR MOTOR</span>
                </button>
            </div>
        </section>

    </main>

    <Footer />
    
    <script is:inline defer src="/js/miniJuego.js"></script>
    <script is:inline defer src="/js/contadores.js"></script>

    <script>
        class HeroSlider extends HTMLElement {
            constructor() {
                super();
                this.interval = null;
                this.slides = [];
                this.currentIndex = 0;
            }

            connectedCallback() {
                this.slides = this.querySelectorAll('.bg-slide');
                if (this.slides.length <= 1) return;
                this.startSlider(4000); 
            }

            disconnectedCallback() {
                this.stopSlider();
            }

            startSlider(time) {
                this.stopSlider();
                this.interval = setInterval(() => this.nextSlide(), time);
            }

            stopSlider() {
                if (this.interval) {
                    clearInterval(this.interval);
                    this.interval = null;
                }
            }

            nextSlide() {
                this.slides[this.currentIndex].classList.remove('active');
                this.currentIndex = (this.currentIndex + 1) % this.slides.length;
                this.slides[this.currentIndex].classList.add('active');
            }
        }
        
        if (!customElements.get('hero-slider')) {
            customElements.define('hero-slider', HeroSlider);
        }
    </script>

</Layout>